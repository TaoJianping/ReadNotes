## 学习目标

1. 现代磁盘驱动器如何存储数据？
2. 接口是什么？
3. 数据如何安排和访问的？
4. 磁盘调度如何提高性能？



## 37.1 接口

驱动器由大量扇区（512字节块）组成，每个扇区都可以读取或者写入。在具有n个扇区的磁盘上，扇区从0到n-1编号。因此我们可以将磁盘视为一组扇区，0到n-1是驱动器的地址空间（address space）。

在更新磁盘时，驱动器制造商唯一保证的是单个512字节的写入是原子的（atomic）。



## 37.2 基本的几何形状

就是组成磁盘的基本硬件

- 盘片（platter）
- 主轴（spindle）
- 磁道（track）
- 磁头（disk head）
- 磁盘臂（disk arm）

>每分钟转速（Rotation Per Minute，RPM）



## 37.3 简单的磁盘驱动器

这章主要讲了由于磁盘的构造所造成的延迟，首先寻道，等待转动延迟，最后读取

- 旋转延迟（rotation delay）
- 寻道过程（seek）
- 停放时间（settling time）
- 传输（transfer）



#### 一些其他细节

- 磁道偏斜（track skew）：扇区往往会偏斜，因为从一个磁道切换到另一个磁道时，需要时间来重新顶一次头。
- 多区域（multi-zoned）磁盘器：越往外的磁道扇区越多，硬件决定
- 缓存（cache）或者叫做磁道缓冲区（track buffer）
- 后写（write back）缓存，有时候称为立即报告（immediate reporting）：写入内存后，回报写入完成

- 直写（write through）：实际写入磁盘后回报写入完成



## 37.4 I/O时间：用数学

这里给了两个公式来理磁盘性能：

1. $$
   T_{I/O} = T_{寻道} + T_{旋转} + T_{传输}
   $$

2. $$
   R_{I/O} = Size_{传输} / T_{I/O}
   $$


我们一般用顺序（sequential）访问和随机（random）访问来分析。

> 补充：计算“平均”寻道时间
>
> TODO



## 37.5 磁盘调度

#### SSTF：最短寻道时间优先

#### 电梯（又称SCAN或C-SCAN）

#### SPTF：最短定位时间优先



#### 其他调度问题

- 在现代系统上执行磁盘调度的地方在哪里？
- I/O合并（I/O merging）
- 在向磁盘发出I/O之前，系统应该等待多久？
  - 工作保全（work-conserving）：即使有一个磁盘I/O，也应该立即向驱动器发出请求
  - 非工作保全（non-work-conserving）：通过“等待”，新的和“更好：的的请求可能会到达磁盘

上面的这几个问题可以通过看Linux源码进行研究。