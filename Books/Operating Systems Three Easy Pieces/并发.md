## 并发



### 背景

线程切换 -> context switch 所依赖的状态块

- PCB: 进程控制块 Process Control Block
- TCB: 线程控制块 Thread Control Block



线程的context switch 和进程的context switch的区别

- 地址空间保持不变，即不需要切换当前使用的页表
- 栈，每个线程都有自己的栈



有了并发之后很多情况变得更糟糕了，因为

1. 共享数据
2. 不可控的调度



### 并发的关键术语

##### 临界区 (critical section)

是访问共享资源的一段代码，资源通常是一个变量或者数据结构



##### 竞态条件 (race condition)

出现在多个执行线程大致同时进入临界区时，他们都试图更新共享的数据结构，导致了令人惊讶的（也许是不希望的）结果。



##### 不确定性 (indeterminate)

程序由一个或者多个竞态条件组成，程序的输出因运行而异，具体取决于那些线程在何时运行，这导致结果是不确定的。



##### 互斥原语  (mutual exclusion)

为了避免这些问题，线程应该使用某种互斥原语。这样做可以保证只有一个线程进入临界区，从而避免出现竟态，并产生确定的程序输出。



### 我们需要研究的问题

为了构建有用的同步语句，我们需要搞清楚

1. 需要从硬件中获得哪些支持？
2. 需要从操作系统中获取哪些支持？
3. 如何正常有效的构建这些原语？
4. 程序如何使用他们来获得期望的结果？







