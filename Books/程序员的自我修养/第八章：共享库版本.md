# 第八章：Linux共享库的组织

- 8.1 共享库的版本
- 8.2 符号版本
- 8.3 共享库系统路径
- 8.4 共享库查找过程
- 8.5 环境变量
- 8.6 共享库的创建和安装
- 本章总结



## 8.1 共享库版本

### 8.1.1 共享库兼容性

主要讨论的是ABI的兼容性。



### 8.1.2 共享版本的命名

Linux的共享库的命名规则

***libname.so.x.y.z***

最前面使用前缀“lib”、中间是库的名字和后缀".so"，最后的是三个数字组成的版本号

- “x”代表的是主版本号（Major Version Number）
- “y”代表的是次版本号（Minor Version Number）
- “z”代表的是发布版本号（Release Version Number）

主版本号不保证兼容，次版本号保证兼容，就算新增一些接口，发布版本号就是一些bug fix之类的，也不对接口进行更改。



### 8.1.3 SO-NAME

共享库的主版本号和次版本号决定了一个共享库的接口。

Linux采用了一个叫**SO-NAME**的命名机制来记录共享库的依赖关系，每个共享库都有一个对应的“SO-NAME”。这个“SO-NAME”的规则就是：

> 共享库的文件名去掉次版本号和发布版本号，保留主版本号。

很明显，“SO-NAME”规定了共享库的接口，只要SO-NAME名字相同，就保证了兼容。

在Linux中，系统会为每个共享库在它所在的目录创建一个跟SO-NAME相同的并且只想他的软连接。保证这个软链接每次都能指向最新的共享库，并且保证主版本号相同就行。

目的就是所有依赖某个共享库的模块，在编译、链接和运行的时候，都是用共享的SO-NAME，而不用详细的版本号。

> 总之：
>
> SO-NAME表示一个库的接口，接口不向后兼容，SO-NAME就发生变化，这就是最基本的原则。

