## 硬盘和显卡的访问控制

#### IN和OUT指令









#### 从硬盘上读逻辑扇区的过程

> 个人计算机上的主硬盘控制器被分配了 8 位端口，端口号从 0x1f0 到 0x1f7。

1. 设置要读取的扇区数量。这个数值要写入 0x1f2 端口

2. 设置起始 LBA 扇区号。28 位的扇区号太长，需要将其分成 4 段，分别写入端口 0x1f3、0x1f4、0x1f5 和 0x1f6 号端口。其中，0x1f3 号端口存放的是 0～7 位；0x1f4 号端口存放的是 8～15 位；0x1f5 号端口存放的是 16～23 位，最后 4 位在 0x1f6 号端口

    - 0x1f6 端口的低 4 位用于存放逻辑扇区号的 24～27位，第 4 位用于指示硬盘号，0 表示主盘，1 表示从盘。高 3 位是“111”，表示 LBA 模式。

        ![image](https://ws3.sinaimg.cn/large/005wgNfbgy1g0uhnkad27j30h708gglx.jpg)

3. 向端口0x1f7写入0x20，请求硬盘读。

4. 等待读写操作完成。端口 0x1f7 既是命令端口，又是状态端口。在通过这个端口发送
    读写命令之后，硬盘就忙乎开了。如图 8-12 所示，在它内部操作期间，它将 0x1f7 端口的第 7 位置
    “1”，表明自己很忙。一旦硬盘系统准备就绪，它再将此位清零，说明自己已经忙完了，同时将第 3
    位置“1”，意思是准备好了，请求主机发送或者接收数据

    ![image](https://wx2.sinaimg.cn/large/005wgNfbgy1g0uhqwyb95j30hv08tq3l.jpg)

5. 

    