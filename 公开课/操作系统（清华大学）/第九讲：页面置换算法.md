### 学习目标

- 页面置换算法的概念
- 局部页面置换算法
  - 最优页面置换算法（OPT，optimal）
  - 先进先出算法（FIFO）
  - 最近最久未使用算法（LRU，Least Recently Used）
  - 时钟页面置换算法（Clock）
  - 最不常用算法（LFU，Least Frequently Used）
  - Belady现象
  - LRU，FIFO和Clock的比较
- 全局页面置换算法
- 最优算法、先进先出算法和最近最久未使用算法
- 时钟置换算法和最不常用算法
- Belady现象和局部置换算法
- 工作集置换算法
- 缺页率置换算法
- 抖动和负载控制



### 页面置换算法的概念

##### 功能

当出现缺页异常，需要调入新页面而内存已满时，置换算法选择被置换的物理页面



##### 设计目标

- 尽可能的减少页面的调入调出次数
- 把未来不再访问或者短期内不访问的页面调出



##### 页面锁定（frame locking）

- 描述必须常驻内存的逻辑页面
- 操作系统的关键部分
- 要求响应速度的代码和数据
- 页表中的锁定标志位（lock bit）



##### 置换算法的评价方法

- 模拟页面置换行为，记录产生缺页的次数
- 更少的缺页，更好的性能



##### 页面置换算法分类

- 局部页面置换算法
  - 置换页面的选择范围仅限于当前进程占用的物理页面内
  - 最优算法，先进先出算法，最近最久未使用算法
  - 时钟算法，最不常用算法
- 全局页面置换算法
  - 置换页面的选择范围是所有可换出的物理页面
  - 工作集算法，缺页率算法



## 局部页面置换算法

### 最优算法

##### 基本思路

- 置换在未来最长时间不访问的页面



##### 算法实现

- 缺页时，计算内存中每个逻辑页面的下一次访问时间
- 选择未来最长时间不访问的页面



##### 算法特征

- 缺页最少，是理想情况
- 实际系统中无法实现，因为无法预知每个页面在下次访问前的等待时间



### 先进先出算法（First-In First-Out，FIFO）

##### 思路

- 选择在内存驻留时间最长的页面进行置换



##### 实现

- 维护一个记录所有位于内存中的逻辑页面的链表
- 链表元素按驻留内存的时间排序，链首最长，链尾最短
- 出现缺页的时候，选择链首页面进行置换，新页面添加到链尾



##### 特征

- 实现简单
- 性能较差，调出的页面可能是经常访问的
- 进程分配物理页面数增加时，缺页并不一定减少，会触发belady现象
- 很少单独使用



### 最近最久未使用算法（Least Recently Used，LRU）

##### 思路
- 选择最长时间没有被引用的页面进行置换
- 如果某些页面长时间未被访问，则他们在将来还可能会长时间不会访问

##### 实现

- 缺页时，计算内存中的每个逻辑页面的上一次访问时间
- 选择上一次使用到当前页面最长的页面

##### 特征

- 最优算法的一种近似
- 可能实现的方法开销都很大

##### 可能的实现方法

- 页面链表
  - 系统维护一个按最近一次访问时间排序的页面链表
    - 链表首节点是最近刚刚使用过的页面
    - 链表尾节点是最久未使用的页面
  - 访问内存时，找到相应的页面，把他移动到链表之首
  - 缺页时，置换链表尾节点的页面
- 活动页面栈
  - 访问页面时，将此页面压入栈顶，并栈内相同页面去除
  - 缺页时，置换栈底的页面





### Belady现象

这个是一个叫Belady的人发现的现象，所以叫这个名字，具体是指随着物理页分配的增多，反而可能出现缺页率的上升，本质上是分配算法和命中页没有相关性，多出现于FIFO算法

下面是官方解释

> 所谓Belady现象是指：在分页式虚拟存储器管理中，发生缺页时的置换算法采用FIFO（[先进先出](https://baike.baidu.com/item/先进先出/9629304)）算法时，如果对一个进程未分配它所要求的全部页面，有时就会出现分配的页面数增多但缺页率反而提高的异常现象。
>
> Belady现象的描述：一个进程P要访问M个页,OS分配N(N<M)个内存页面给进程P;对一个访问序列S,发生缺页次数为PE(S,N).当N增大(且N小于M)时,PE(S, N)时而增大,时而减小。
>
> FIFO是最早出现的页置换算法之一。Belady现象的原因是FIFO算法的置换特征与进程访问内存的动态特征是矛盾的，即被置换的页面并不是进程不会访问的，因而FIFO并不是一个好的置换算法。
>
> Belady和抖动并不完全一样。